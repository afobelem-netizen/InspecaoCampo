<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Inspeções Online</title>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; max-width: 600px; margin: auto; }
  input, textarea, button { display: block; margin: 10px 0; padding: 8px; width: 100%; }
  .resultado { margin-top: 20px; white-space: pre-wrap; background: #f5f5f5; padding: 10px; border-radius: 5px; }
</style>
</head>
<body>

<h2>Cadastro de Inspeção</h2>
<form id="formInspecao">
  <input type="date" id="data" required>
  <input type="text" id="local" placeholder="Local" required>
  <input type="text" id="responsavel" placeholder="Responsável" required>
  <textarea id="observacoes" placeholder="Observações"></textarea>
  <button type="submit">Salvar</button>
</form>

<hr>

<h2>Pesquisar Inspeções</h2>
<input type="text" id="filtro" placeholder="Digite termo para buscar">
<button onclick="pesquisar()">Pesquisar</button>
<div class="resultado" id="resultado"></div>

<script>
const usuario = "afobelem-netizen";
const repo = "InspecaoCampo";

// --- Cadastro redirecionando para GitHub ---
document.getElementById("formInspecao").addEventListener("submit", function(e) {
    e.preventDefault();

    const titulo = encodeURIComponent(`Inspeção - ${document.getElementById("local").value} - ${document.getElementById("data").value}`);
    const corpo = encodeURIComponent(
`Data: ${document.getElementById("data").value}
Local: ${document.getElementById("local").value}
Responsável: ${document.getElementById("responsavel").value}
Observações: ${document.getElementById("observacoes").value}`
    );

    const url = `https://github.com/${usuario}/${repo}/issues/new?title=${titulo}&body=${corpo}`;
    window.open(url, "_blank"); // abre em nova aba
});

// --- Pesquisa de Issues ---
async function pesquisar() {
    const termo = document.getElementById("filtro").value.toLowerCase();
    const url = `https://api.github.com/repos/${usuario}/${repo}/issues`;
    let response = await fetch(url);
    let issues = await response.json();

    let filtradas = issues.filter(issue =>
        issue.title.toLowerCase().includes(termo) ||
        issue.body.toLowerCase().includes(termo)
    );

    let saida = filtradas.map(i => `#${i.number} - ${i.title}\n${i.body}\n---`).join("\n");
    document.getElementById("resultado").textContent = saida || "Nenhum resultado encontrado";
}
</script>

</body>
</html>
